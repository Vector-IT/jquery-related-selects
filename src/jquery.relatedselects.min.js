/*
 * jQuery Related Selects plug-in 1.1
 *
 * https://github.com/Vector-IT/jquery-related-selects
 * 
 * Forked from 
 * http://github.com/ehynds/jquery-related-selects
 *
 * Copyright (c) 2009 Eric Hynds, 2018 Vector-IT
 *
 * Dual licensed under the MIT and GPL licenses:
 *   http://www.opensource.org/licenses/mit-license.php
 *   http://www.gnu.org/licenses/gpl.html
 */
!function(u){u.fn.relatedSelects=function(e){return e=u.extend({},u.fn.relatedSelects.defaults,e),this.each(function(){new t(this,e)})};var t=function(e,d){var s=u(e),c=[];function f(e,t,n,a){if(t.length){var o=u.trim(e.val());0<o.length&&o!==a.loadingMessage&&t?(l(n),function(a,o,l){for(var e,t=[],n=0,i=c.length;n<i;n++)t.push('select[name="'+c[n]+'"]');e=u(t.join(","),s).serialize(),o.attr("disabled","disabled").html('<option value="">'+l.loadingMessage+"</option>"),u.ajax({beforeSend:function(){l.onLoadingStart.call(o)},complete:function(){l.onLoadingEnd.call(o)},dataType:l.dataType,data:e,url:l.onChangeLoad,success:function(e){var n=[],t=o.data("defaultOption");0<t.length&&n.push('<option value="" selected="selected">'+t+"</option>"),"json"===l.dataType&&"object"==typeof e&&e?(u.each(e,function(e,t){n.push('<option value="'+e+'">'+t+"</option>")}),o.html(n.join("")).removeAttr("disabled")):"html"===l.dataType&&0<u.trim(e).length?(n.push(u.trim(e)),o.html(n.join("")).removeAttr("disabled")):(o.html(n.join("")),l.disableIfEmpty||o.removeAttr("disabled"),l.onEmptyResult.call(a))}})}(e,t,a)):t&&l(n)}}function l(e){for(var t=r(e)+1,n=c.length;t<n;t++)u("select[name='"+c[t]+"']",s).attr("disabled","disabled").find("option:first").prop("selected","selected")}function r(e){for(var t=0,n=c.length;t<n;t++)if(c[t]===e)return t}u.isArray(d.selects)&&function(){var e=d.selects;d.selects={};for(var t=0,n=e.length;t<n;t++)d.selects[e[t]]={}}(),u.each(d.selects,function(){c.push(key)}),function(){for(var e,t,n=1,a=c.length;n<a;n++)e=s.find("select[name='"+c[n]+"']"),t=e.find("option[value='']").text(),e.data("defaultOption",t)}(),u.each(d.selects,function(e,t){var n,a,o=s.find("select[name='"+e+"']"),l=(n=e,s.find("select[name='"+c[r(n)+1]+"']")),i=o.val();(t=u.extend({defaultOptionText:d.defaultOptionText||o.data("defaultOption")},d,t),o.data("defaultOption",t.defaultOptionText),o.change(function(){t.onChange.call(o),f(o,l,e,t)}),i&&0<i.length&&(0!==(a=l.find("option")).length&&(1!==a.length||0!==a.filter(":first").attr("value").length)))||f(o,l,e,t)})};u.fn.relatedSelects.defaults={selects:{},loadingMessage:"Loading, please wait...",disableIfEmpty:!1,dataType:"json",onChangeLoad:"",onLoadingStart:function(){},onLoadingEnd:function(){},onChange:function(){},onEmptyResult:function(){}}}(jQuery);
